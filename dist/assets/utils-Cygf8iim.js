const e=new class{constructor(){this.submissions=new Map,this.cleanupInterval=3e5,setInterval(()=>this.cleanup(),this.cleanupInterval)}canSubmit(e,t=10,s=6e5){const r=Date.now(),i=(this.submissions.get(e)||[]).filter(e=>r-e<s);return this.submissions.set(e,i),i.length<t}recordSubmission(e){const t=Date.now(),s=this.submissions.get(e)||[];s.push(t),this.submissions.set(e,s)}getTimeUntilNextSubmission(e,t=6e5){const s=this.submissions.get(e)||[];if(0===s.length)return 0;const r=Math.min(...s),i=t-(Date.now()-r);return Math.max(0,i)}cleanup(){const e=Date.now();for(const[t,s]of this.submissions.entries()){const r=s.filter(t=>e-t<36e5);0===r.length?this.submissions.delete(t):this.submissions.set(t,r)}}getUserIdentifier(){const e=navigator.userAgent,t=`${screen.width}x${screen.height}`,s=Intl.DateTimeFormat().resolvedOptions().timeZone;return btoa(`${e}-${t}-${s}`).slice(0,32)}},t=e=>{const t=new FormData(e),s={};for(let[r,i]of t.entries());for(let[r,i]of t.entries())s[r]?Array.isArray(s[r])?s[r].push(i):s[r]=[s[r],i]:s[r]=i;if(["firstName","lastName","name","email","phone","streetAddress","city","state","zip","address","referrer","service","otherDetails","notes"].forEach(e=>{s.hasOwnProperty(e)||(s[e]="")}),s.name&&0!==s.name.trim().length||!s.firstName&&!s.lastName||(s.name=`${(s.firstName||"").trim()} ${(s.lastName||"").trim()}`.trim()),s.streetAddress||s.city||s.state||s.zip){const e=[(s.streetAddress||"").trim(),(s.city||"").trim(),[(s.state||"").trim(),(s.zip||"").trim()].filter(Boolean).join(" ")].filter(Boolean).join(", ");e&&e.length>0&&(s.address=e)}return s.apiKey="HCCC_SECURE_2024_Kj8mN9pQ2wX5vB7nM3kL9sR4tY6uI8oP",s.timestamp=(new Date).toISOString(),s.userAgent=navigator.userAgent,s.referer=window.location.origin,s.screenResolution=`${screen.width}x${screen.height}`,s.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone,s.language=navigator.language,s.referrer&&0!==String(s.referrer).trim().length||(s.referrer="unspecified"),s.pageReferrer=document.referrer||"",s},s=e=>{const t=[];(!e.firstName||e.firstName.trim().length<1)&&t.push("First name is required"),(!e.lastName||e.lastName.trim().length<1)&&t.push("Last name is required"),(!e.name||e.name.trim().length<2)&&t.push("Full name must be at least 2 characters long"),e.email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||t.push("Please enter a valid email address"),(!e.phone||e.phone.trim().length<10)&&t.push("Please enter a valid phone number"),(!e.streetAddress||e.streetAddress.trim().length<3)&&t.push("Street address is required"),(!e.city||e.city.trim().length<2)&&t.push("City is required"),(!e.state||e.state.trim().length<2)&&t.push("State is required"),(!e.zip||e.zip.trim().length<5)&&t.push("ZIP code is required"),(!e.address||e.address.trim().length<5)&&t.push("Please enter a complete address"),(!e.referrer||e.referrer.trim().length<1)&&t.push("Please tell us how you heard about us"),e.service&&(Array.isArray(e.service)?0!==e.service.length:e.service)||t.push("Please select at least one service type");return!(Array.isArray(e.service)?e.service:[e.service]).includes("other")||e.otherDetails&&0!==e.otherDetails.trim().length||t.push("Please describe the other services you are looking for"),t},r=((t,s=3,r=6e5)=>async(...i)=>{const n=e.getUserIdentifier();if(!e.canSubmit(n,s,r)){const t=e.getTimeUntilNextSubmission(n,r),s=Math.ceil(t/6e4);throw new Error(`Too many submissions. Please wait ${s} minute${1!==s?"s":""} before submitting again.`)}return e.recordSubmission(n),await t(...i)})(async e=>{try{const t=await fetch("https://hccc-db-production.up.railway.app/api/leads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors"});if(!t.ok){const e=await t.json().catch(()=>({}));if(e.errors){const t=Object.values(e.errors);throw new Error(t.join(", "))}throw new Error(e.message||e.error||`HTTP error! status: ${t.status}`)}await t.json();return{success:!0,message:"Lead submitted successfully"}}catch(t){if("TypeError"===t.name&&t.message.includes("fetch"))throw new Error("Unable to connect to server. Please check your internet connection.");throw t}},10,6e5);export{t as f,r as s,s as v};
